```chatagent
---
description: 計画テンプレートを使用して実装計画ワークフローを実行し、設計成果物を生成します。
handoffs: 
  - label: タスクの作成
    agent: speckit.tasks
    prompt: 計画をタスクに分解してください
    send: true
  - label: チェックリストの作成
    agent: speckit.checklist
    prompt: 以下のドメインのチェックリストを作成してください...
---

## ユーザー入力

```text
$ARGUMENTS
```

以下に進む前に、ユーザー入力を**必ず**考慮してください（空でない場合）。

## 概要

1. **セットアップ**: リポジトリルートから `.specify/scripts/bash/setup-plan.sh --json` を実行し、JSONからFEATURE_SPEC、IMPL_PLAN、SPECS_DIR、BRANCHを解析します。引数にシングルクォートが含まれる場合（例: "I'm Groot"）は、エスケープ構文を使用してください: 例 'I'\''m Groot'（または可能であればダブルクォート: "I'm Groot"）。

2. **コンテキストの読み込み**: FEATURE_SPECと `.specify/memory/constitution.md` を読み込みます。IMPL_PLANテンプレート（既にコピー済み）を読み込みます。

3. **計画ワークフローの実行**: IMPL_PLANテンプレートの構造に従って:
   - 技術コンテキストを記入（不明な点は「NEEDS CLARIFICATION」としてマーク）
   - コンスティテューションからコンスティテューションチェックセクションを記入
   - ゲートを評価（正当化されていない違反はERROR）
   - フェーズ0: research.mdを生成（すべてのNEEDS CLARIFICATIONを解決）
   - フェーズ1: data-model.md、contracts/、quickstart.mdを生成
   - フェーズ1: エージェントスクリプトを実行してエージェントコンテキストを更新
   - 設計後にコンスティテューションチェックを再評価

4. **停止して報告**: コマンドはフェーズ2の計画後に終了します。ブランチ、IMPL_PLANのパス、生成された成果物を報告します。

## フェーズ

### フェーズ0: 概要と調査

1. **上記の技術コンテキストから不明点を抽出**:
   - 各NEEDS CLARIFICATION → 調査タスク
   - 各依存関係 → ベストプラクティスタスク
   - 各統合 → パターンタスク

2. **調査エージェントの生成とディスパッチ**:

   ```text
   技術コンテキストの各不明点について:
     タスク: "{フィーチャーコンテキスト}における{不明点}を調査"
   各技術選択について:
     タスク: "{ドメイン}における{技術}のベストプラクティスを調査"
   ```

3. **調査結果の統合** を `research.md` に以下の形式で記載:
   - 決定事項: [何を選択したか]
   - 根拠: [なぜ選択したか]
   - 検討した代替案: [他に何を評価したか]

**出力**: すべてのNEEDS CLARIFICATIONが解決されたresearch.md

### フェーズ1: 設計とコントラクト

**前提条件:** `research.md` が完了していること

1. **フィーチャー仕様からエンティティを抽出** → `data-model.md`:
   - エンティティ名、フィールド、リレーションシップ
   - 要件からのバリデーションルール
   - 該当する場合は状態遷移

2. **機能要件からAPIコントラクトを生成**:
   - 各ユーザーアクション → エンドポイント
   - 標準的なREST/GraphQLパターンを使用
   - OpenAPI/GraphQLスキーマを `/contracts/` に出力

3. **エージェントコンテキストの更新**:
   - `.specify/scripts/bash/update-agent-context.sh copilot` を実行
   - これらのスクリプトは使用中のAIエージェントを検出します
   - 適切なエージェント固有のコンテキストファイルを更新
   - 現在の計画からの新しい技術のみを追加
   - マーカー間の手動追加を保持

**出力**: data-model.md、/contracts/*、quickstart.md、エージェント固有ファイル

## 主要ルール

- 絶対パスを使用すること
- ゲート失敗または未解決の明確化事項がある場合はERROR

```
