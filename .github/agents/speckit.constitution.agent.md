```chatagent
---
description: 対話型または提供された原則入力からプロジェクトコンスティテューションを作成・更新し、すべての依存テンプレートの同期を維持します。
handoffs: 
  - label: 仕様の作成
    agent: speckit.specify
    prompt: 更新されたコンスティテューションに基づいてフィーチャー仕様を実装してください。構築したいものは...
---

## ユーザー入力

```text
$ARGUMENTS
```

以下に進む前に、ユーザー入力を**必ず**考慮してください（空でない場合）。

## 概要

`.specify/memory/constitution.md` のプロジェクトコンスティテューションを更新します。このファイルは角括弧内にプレースホルダートークン（例: `[PROJECT_NAME]`、`[PRINCIPLE_1_NAME]`）を含むテンプレートです。あなたの仕事は (a) 具体的な値を収集/導出し、(b) テンプレートを正確に埋め、(c) 依存アーティファクト全体に修正を反映させることです。

**注意**: `.specify/memory/constitution.md` がまだ存在しない場合、プロジェクトセットアップ中に `.specify/templates/constitution-template.md` から初期化されているはずです。存在しない場合は、まずテンプレートをコピーしてください。

以下の実行フローに従ってください：

1. `.specify/memory/constitution.md` の既存コンスティテューションを読み込みます。
   - `[ALL_CAPS_IDENTIFIER]` の形式のすべてのプレースホルダートークンを特定します。
   **重要**: ユーザーはテンプレートで使用されている原則よりも少ない、または多い原則を要求する場合があります。数が指定されている場合はそれを尊重し、一般的なテンプレートに従ってください。ドキュメントはそれに応じて更新します。

2. プレースホルダーの値を収集/導出します：
   - ユーザー入力（会話）が値を提供している場合、それを使用します。
   - それ以外の場合、既存のリポジトリコンテキスト（README、ドキュメント、以前のコンスティテューションバージョンが埋め込まれている場合）から推論します。
   - ガバナンス日付について: `RATIFICATION_DATE` は元の採択日（不明な場合は質問するかTODOとマーク）、`LAST_AMENDED_DATE` は変更が行われた場合は今日、それ以外は前回の日付を維持。
   - `CONSTITUTION_VERSION` はセマンティックバージョニングルールに従ってインクリメントする必要があります：
     - MAJOR: 後方互換性のないガバナンス/原則の削除または再定義。
     - MINOR: 新しい原則/セクションの追加または実質的なガイダンスの拡張。
     - PATCH: 明確化、表現、タイポ修正、非セマンティクスの改善。
   - バージョンバンプの種類が曖昧な場合、確定前に理由を提案します。

3. 更新されたコンスティテューションの内容を起草します：
   - すべてのプレースホルダーを具体的なテキストに置き換えます（プロジェクトがまだ定義しないことを選択した意図的に保持されたテンプレートスロットを除き、角括弧トークンは残さない。残す場合は明示的に正当化）。
   - 見出し階層を維持し、コメントは置き換え後に削除できます（まだ明確化のガイダンスを追加する場合を除く）。
   - 各原則セクションが以下を確保: 簡潔な名前行、交渉不可のルールを含む段落（または箇条書きリスト）、明白でない場合は明示的な根拠。
   - ガバナンスセクションが修正手順、バージョニングポリシー、コンプライアンスレビューの期待値をリストすることを確認。

4. 一貫性の伝播チェックリスト（以前のチェックリストをアクティブな検証に変換）:
   - `.specify/templates/plan-template.md` を読み込み、「コンスティテューションチェック」やルールが更新された原則と整合していることを確認。
   - `.specify/templates/spec-template.md` をスコープ/要件の整合性のために読み込み、コンスティテューションが必須セクションや制約を追加/削除した場合は更新。
   - `.specify/templates/tasks-template.md` を読み込み、タスク分類が新しいまたは削除された原則駆動のタスクタイプ（例: オブザーバビリティ、バージョニング、テスト規律）を反映していることを確認。
   - `.specify/templates/commands/*.md` の各コマンドファイル（このファイルを含む）を読み込み、汎用ガイダンスが必要な場合に古い参照（CLAUDEのみなどのエージェント固有の名前）が残っていないことを確認。
   - ランタイムガイダンスドキュメント（例: `README.md`、`docs/quickstart.md`、またはエージェント固有のガイダンスファイルが存在する場合）を読み込みます。変更された原則への参照を更新します。

5. 同期影響レポートを作成（更新後にコンスティテューションファイルの先頭にHTMLコメントとして追加）:
   - バージョン変更: 旧 → 新
   - 変更された原則のリスト（名前が変更された場合は旧タイトル → 新タイトル）
   - 追加されたセクション
   - 削除されたセクション
   - 更新が必要なテンプレート（✅ 更新済み / ⚠ 保留中）ファイルパス付き
   - プレースホルダーが意図的に延期された場合のフォローアップTODO。

6. 最終出力前の検証:
   - 説明のない角括弧トークンが残っていないこと。
   - バージョン行がレポートと一致すること。
   - 日付がISO形式 YYYY-MM-DD であること。
   - 原則が宣言的で、テスト可能で、あいまいな言語がないこと（「should」→ 適切な場合はMUST/SHOULDの根拠に置き換え）。

7. 完成したコンスティテューションを `.specify/memory/constitution.md` に書き戻します（上書き）。

8. ユーザーに最終サマリーを出力します：
   - 新しいバージョンとバンプの根拠。
   - 手動フォローアップが必要とフラグされたファイル。
   - 提案されるコミットメッセージ（例: `docs: コンスティテューションをvX.Y.Zに修正（原則の追加 + ガバナンス更新）`）。

フォーマットとスタイルの要件:

- テンプレートと同じMarkdown見出しを使用してください（レベルの降格/昇格はしない）。
- 読みやすさのために長い根拠行を折り返します（理想的には~100文字未満）が、不自然な改行で強制しないでください。
- セクション間に1つの空行を維持。
- 末尾の空白を避ける。

ユーザーが部分的な更新を提供した場合（例: 1つの原則のみの改訂）でも、検証とバージョン決定のステップを実行してください。

重要情報が不足している場合（例: 制定日が本当に不明）、`TODO(<FIELD_NAME>): 説明` を挿入し、同期影響レポートの延期項目に含めてください。

新しいテンプレートを作成しないでください。常に既存の `.specify/memory/constitution.md` ファイルで操作してください。

```
