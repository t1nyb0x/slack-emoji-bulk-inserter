# 実装計画: Slack絵文字一括登録

**ブランチ**: `001-bulk-emoji-insert` | **日付**: 2026-02-22 | **仕様**: [spec.md](spec.md)
**入力**: `/specs/001-bulk-emoji-insert/spec.md` からのフィーチャー仕様

## サマリー

Slackのカスタマイズページ（`{workspace}.slack.com/customize/emoji`）で動作するChrome拡張機能を構築する。Content Scriptでページ上部にドロップゾーンを挿入し、ユーザーがドラッグ＆ドロップした画像ファイルをSlack内部API（`/api/emoji.add`）を通じて順次登録する。各絵文字の登録状態はステータスアイコンでリアルタイム表示する。

技術的には、ページに埋め込まれた`boot_data`から`api_token`を正規表現で抽出し、Content Scriptから直接`fetch`でAPIを呼び出す（同一オリジンのためCORS問題なし）。各リクエスト間に固定ディレイ（500ms〜1秒）を挟みレートリミットを回避する。

## 技術コンテキスト

**言語/バージョン**: TypeScript 5.x（strict mode）
**主要な依存関係**: esbuild（ビルド）、@types/chrome（型定義）
**ストレージ**: N/A（永続化不要）
**テスト**: N/A（仕様でテストは要求されていない）
**ターゲットプラットフォーム**: Chrome拡張機能（Manifest V3）
**プロジェクトタイプ**: single（Content Script 1つ + manifest.json）
**パフォーマンス目標**: 各絵文字登録のAPIレスポンスを1秒以内に処理
**制約**: リクエスト間500ms〜1秒のディレイ（レートリミット回避）
**スケール/スコープ**: 1回あたり100枚以上の画像をキューイング可能

## コンスティテューションチェック

*ゲート: フェーズ0の調査前にパスする必要あり。フェーズ1の設計後に再チェック。*

| 原則 | 設計前 | 設計後 | 備考 |
| --- | --- | --- | --- |
| I. クリーンコード | ✅ PASS | ✅ PASS | 自己説明的な命名規則を採用。モジュール分割により各ファイルの責務が明確 |
| II. 早期リターン | ✅ PASS | ✅ PASS | トークン抽出失敗・ファイルバリデーション失敗時にガード節で早期リターン |
| III. メソッド行数制限（50行） | ✅ PASS | ✅ PASS | 機能ごとにモジュール分割済み（token.ts, emoji-api.ts, normalize.ts, drop-zone.ts） |
| IV. 単一責任メソッド | ✅ PASS | ✅ PASS | 各モジュールが1つの責務のみを持つ設計 |
| TypeScript必須 | ✅ PASS | ✅ PASS | 全ソースコードをTypeScriptで記述 |
| any型禁止 | ✅ PASS | ✅ PASS | strict modeを有効化し、any型の使用を防止 |

**ゲート結果**: すべてパス。違反なし。

## プロジェクト構造

### ドキュメント（このフィーチャー）



### ソースコード（リポジトリルート）



**構造の決定**: 単一プロジェクト構造を採用。Content Script 1つ + manifest.jsonのシンプルな構成。UIフレームワーク不使用で、DOMを直接操作する。各機能は`utils/`と`ui/`に分離し、単一責任の原則を維持する。

## 複雑性の追跡

> コンスティテューションチェックに正当化が必要な違反がないため、このセクションは空。
