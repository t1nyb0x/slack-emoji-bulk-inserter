# APIコントラクト: Slack emoji.add

**フィーチャー**: `001-bulk-emoji-insert`
**作成日**: 2026-02-22

本拡張機能が利用するSlack内部APIエンドポイントの仕様を定義する。
これは公式にドキュメント化されたAPIではなく、Slackカスタマイズページが内部的に使用するエンドポイントである。

---

## POST `/api/emoji.add`

### リクエスト

**URL**: `https://{workspace}.slack.com/api/emoji.add`
**メソッド**: `POST`
**Content-Type**: `multipart/form-data`
**認証**: FormData内の`token`フィールド + ブラウザのセッションCookie（自動付与）

### FormData フィールド

| フィールド | 型       | 必須 | 説明                                                                                            |
| ---------- | -------- | ---- | ----------------------------------------------------------------------------------------------- |
| `token`    | `string` | はい | ページの`boot_data`から抽出した`xoxs-`セッショントークン                                        |
| `name`     | `string` | はい | 登録する絵文字名（`:name:` として使用される部分）。英小文字・数字・ハイフン・アンダースコアのみ |
| `mode`     | `string` | はい | `"data"` 固定（画像データを直接アップロードする場合）                                           |
| `image`    | `File`   | はい | 画像ファイル（PNG、JPEG、GIF）                                                                  |

### レスポンス

HTTP ステータスコードは成功・失敗にかかわらず **200** が返る。
判定は必ずレスポンスボディの `ok` フィールドで行う。

#### 成功

```json
{
  "ok": true
}
```

#### 失敗

```json
{
  "ok": false,
  "error": "<error_code>"
}
```

### エラーコード

| エラーコード            | 説明                                   | 本拡張での対応                                 |
| ----------------------- | -------------------------------------- | ---------------------------------------------- |
| `error_name_taken`      | 同名の絵文字が既に存在する             | ステータスを`failed`に設定し、次の絵文字に進む |
| `error_name_taken_i18n` | 同名の絵文字が国際化対応で既に存在する | 同上                                           |
| `too_many_emoji`        | ワークスペースの絵文字上限に到達       | ステータスを`failed`に設定し、次の絵文字に進む |
| `not_authed`            | トークンが送信されていない             | ステータスを`failed`に設定                     |
| `invalid_auth`          | トークンが無効（セッション切れ等）     | ステータスを`failed`に設定                     |
| `no_image_uploaded`     | 画像ファイルが添付されていない         | ステータスを`failed`に設定                     |
| `invalid_name`          | 絵文字名が不正                         | ステータスを`failed`に設定                     |

### レートリミット

| 項目           | 詳細                                                           |
| -------------- | -------------------------------------------------------------- |
| HTTPステータス | `429 Too Many Requests`                                        |
| ヘッダ         | `Retry-After: <秒数>`                                          |
| 本拡張の対策   | 各リクエスト間に固定ディレイ（500ms〜1秒）を挟むことで予防する |
