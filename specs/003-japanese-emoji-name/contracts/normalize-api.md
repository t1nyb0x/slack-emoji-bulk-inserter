# APIコントラクト: normalizeEmojiName

**フィーチャー**: `003-japanese-emoji-name`
**作成日**: 2026-02-22

本ドキュメントは、`normalizeEmojiName()` 関数の改修後のコントラクトを定義する。

---

## 関数シグネチャ（変更なし）

```typescript
/**
 * ファイル名から絵文字名を正規化する。
 *
 * 5ステップ:
 * 1. 拡張子を除去
 * 2. 大文字を小文字に変換
 * 3. 空白・ドットを _ に置換
 * 4. 英小文字・数字・ハイフン・アンダースコア・日本語文字（ひらがな・カタカナ・漢字）以外を除去
 * 5. 空文字列チェック（空の場合はnullを返す）
 */
export function normalizeEmojiName(fileName: string): string | null;
```

## 入出力例

### 日本語ファイル名（新規対応）

| 入力 | 出力 | 説明 |
|------|------|------|
| `"笑顔.png"` | `"笑顔"` | 漢字保持 |
| `"おはよう.png"` | `"おはよう"` | ひらがな保持 |
| `"ネコ.png"` | `"ネコ"` | カタカナ保持 |
| `"ラーメン.png"` | `"ラーメン"` | 長音符（U+30FC）はカタカナ範囲内 |
| `"Hello_世界.png"` | `"hello_世界"` | ASCII小文字化 + 漢字保持 |
| `"日本語 テスト.png"` | `"日本語_テスト"` | 空白→`_`、日本語保持 |
| `"猫.ちゃん.png"` | `"猫_ちゃん"` | ドット→`_`、日本語保持 |

### ASCIIファイル名（既存動作維持）

| 入力 | 出力 | 説明 |
|------|------|------|
| `"test.png"` | `"test"` | 変更なし |
| `"My Emoji.png"` | `"my_emoji"` | 変更なし |
| `"Hello-World.png"` | `"hello-world"` | 変更なし |
| `"test_123.png"` | `"test_123"` | 変更なし |

### エッジケース

| 入力 | 出力 | 説明 |
|------|------|------|
| `"😀.png"` | `null` | 絵文字Unicode → 除去 → 空 → null |
| `"ＨＥＬＬＯ.png"` | `null` | 全角英数字 → 対象範囲外 → 除去 → 空 → null |
| `".hidden.png"` | `null` | ドットファイル → 既存動作維持 |
| `"a.b.c.png"` | `"a_b_c"` | 複数ドット → `_` 置換 |

---

## sanitize regex（変更箇所）

### 変更前

```regex
/[^a-z0-9\-_]/g
```

### 変更後

```regex
/[^a-z0-9\-_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FFF\u3400-\u4DBF\uF900-\uFAFF]/g
```

### Unicode範囲の内訳

```
\u3040-\u309F  → ひらがな（あ-ん、ゔ、小文字かな、繰り返し記号）
\u30A0-\u30FF  → カタカナ（ア-ン、ヴ、長音符ー、小文字カナ、繰り返し記号）
\u4E00-\u9FFF  → CJK統合漢字（基本漢字約20,000字）
\u3400-\u4DBF  → CJK統合漢字拡張A（追加漢字約6,500字）
\uF900-\uFAFF  → CJK互換漢字（異体字約500字）
```
