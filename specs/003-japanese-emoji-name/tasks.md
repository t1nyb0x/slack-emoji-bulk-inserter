# タスク: 日本語絵文字名対応（ひらがな・カタカナ・漢字）

**入力**: `/specs/003-japanese-emoji-name/` からの設計ドキュメント
**前提条件**: plan.md（必須）、spec.md（ユーザーストーリーに必須）、research.md、data-model.md、contracts/

**テスト**: 仕様でテストは要求されていないため（plan.md: テスト: N/A）、テストタスクは含まれていません。

**整理**: 変更対象は2ファイルのみ。2ファイルは独立しているため並列実行可能。新規ファイルの追加なし。

## 形式: `[ID] [P?] [Story] 説明`

- **[P]**: 並列実行可能（異なるファイル、依存関係なし）
- **[Story]**: このタスクが属するユーザーストーリー（例: US1）
- 説明に正確なファイルパスを含めること

## パス規約

- **単一プロジェクト**: リポジトリルートの `src/`
- ビルド出力: `dist/`
- 設定ファイル: リポジトリルート

---

## フェーズ1: セットアップ・基盤

**スキップ**: 既存 Chrome 拡張プロジェクト（`001-bulk-emoji-insert` + `002-ui-enhancement` 完了済み）。新規ファイル・新規型定義・インフラ変更なし。実装フェーズへ直行。

---

## フェーズ2: ユーザーストーリー1 — 日本語ファイル名の絵文字登録（優先度: P1）🎯 MVP

**目標**: 日本語名（ひらがな・カタカナ・漢字）のファイルをドロップした際に、ファイル名の日本語部分が保持された状態でAPIに送信されるようにする。Slackが拒否した際のエラーコード `error_bad_name_i18n` にも対応する。

**独立テスト**: `笑顔.png`・`おはよう.png`・`ネコ.png`・`Hello_世界.png` をドロップし、ステータスリストの絵文字名に日本語文字が含まれていることを確認する（quickstart.mdのテストケース参照）

### ユーザーストーリー1の実装

- [ ] T001 [P] [US1] `src/utils/normalize.ts` の sanitize regex（ステップ4）を `/[^a-z0-9\-_]/g` から `/[^a-z0-9\-_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FFF\u3400-\u4DBF\uF900-\uFAFF]/g` に変更し、JSDocのステップ4の説明を「英小文字・数字・ハイフン・アンダースコア・日本語文字（ひらがな・カタカナ・漢字）以外を除去」に更新する（contracts/normalize-api.md、data-model.md のUnicode範囲に基づく）
- [ ] T002 [P] [US1] `src/ui/error-messages.ts` の `ERROR_MESSAGES` に `error_bad_name_i18n: "絵文字名が無効です"` エントリを追加する（spec.md FR-307、明確化事項「Slackが日本語名を拒否した場合に `error_bad_name_i18n` を返す可能性がある」に基づく）

**チェックポイント**: T001・T002 完了後に `npm run build` が成功し、日本語ファイル名のドロップでステータスリストに日本語絵文字名が表示される

---

## フェーズ3: 仕上げ

**目的**: ビルド確認とコンスティテューション遵守の最終検証

- [ ] T003 `npm run build` を実行し、TypeScriptコンパイルエラーがないことを確認する
- [ ] T004 quickstart.mdのテストケース6件（`笑顔.png`・`おはよう.png`・`ネコ.png`・`Hello_世界.png`・`test.png`・`My Emoji.png`）を実機で確認し、既存ASCIIファイル名の動作に変化がないことをSC-304として検証する

---

## 依存関係グラフ

```
T001 [P] ──┐
           ├──→ T003（ビルド）──→ T004（実機確認）
T002 [P] ──┘
```

- T001・T002: 並列実行可能（独立したファイルへの変更）
- T003: T001・T002 の完了後に実行
- T004: T003 の成功後に実行

---

## 並列実行例

```bash
# T001・T002 は並列で実行可能（独立ファイル）
[エディタA] src/utils/normalize.ts の regex 修正（T001）
[エディタB] src/ui/error-messages.ts へのエントリ追加（T002）

# 完了後
npm run build  # T003
```

---

## 実装戦略

- **MVP スコープ**: US1 のみ（フェーズ2）が本フィーチャーの全スコープ
- **変更規模**: 2ファイル・計2行の変更（正規表現1行 + マッピング1行）
- **リスク**: 低。既存の型・インターフェース・ロジックへの影響なし
- **ロールバック**: git revert で即座に元の状態に戻せる

---

## フォーマット検証

| タスクID | チェックボックス | ID  | [P] | [Story] | ファイルパス                  |
| -------- | ---------------- | --- | --- | ------- | ----------------------------- |
| T001     | ✅               | ✅  | ✅  | ✅      | ✅ `src/utils/normalize.ts`   |
| T002     | ✅               | ✅  | ✅  | ✅      | ✅ `src/ui/error-messages.ts` |
| T003     | ✅               | ✅  | —   | —       | — （ビルドコマンド）          |
| T004     | ✅               | ✅  | —   | —       | — （実機確認）                |
